"use strict";(self.webpackChunksite_3=self.webpackChunksite_3||[]).push([[8548],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>y});var r=n(96540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=i,y=d["".concat(l,".").concat(u)]||d[u]||h[u]||o;return n?r.createElement(y,a(a({ref:t},p),{},{components:n})):r.createElement(y,a({ref:t},p))}));function y(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:i,a[1]=s;for(var c=2;c<o;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},25188:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(58168),i=(n(96540),n(15680));const o={},a="Third party dependencies and licensing",s={type:"mdx",permalink:"/community/licensing",source:"@site/src/pages/community/licensing.md",title:"Third party dependencies and licensing",description:"The bookkeeper project ships one source distribution and two binary distributions.",frontMatter:{}},l=[{value:"dev/check-binary-license script",id:"devcheck-binary-license-script",level:2},{value:"Apache Software License, Version 2 binary dependencies",id:"apache-software-license-version-2-binary-dependencies",level:2},{value:"BSD/MIT style license binary dependencies",id:"bsdmit-style-license-binary-dependencies",level:2},{value:"Further resources",id:"further-resources",level:2}],c={toc:l},p="wrapper";function d(e){let{components:t,...n}=e;return(0,i.yg)(p,(0,r.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"third-party-dependencies-and-licensing"},"Third party dependencies and licensing"),(0,i.yg)("p",null,"The bookkeeper project ships one source distribution and two binary distributions."),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"bookkeeper-<version>-src.tar.gz"),", which contains the source code to build bookkeeper."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"bookkeeper-all-<version>-bin.tar.gz"),", which contains the bookkeeper server and all optional dependencies."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"bookkeeper-server-<version>-bin.tar.gz"),", which contains the bare minimum to run a bookkeeper server.")),(0,i.yg)("p",null,"The source distribution can contain source code copied from third parties. The binaries ship with third party dependencies in jar file form. "),(0,i.yg)("p",null,"As the ASF may not own the copyright on the contents of this copied source code or third party jars, we may need to account for them in the LICENSE and/or NOTICE file of the distribution."),(0,i.yg)("p",null,"The LICENSE and NOTICE files for the source distribution are found at:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/LICENSE"},"bookkeeper/LICENSE")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/NOTICE"},"bookkeeper/NOTICE"))),(0,i.yg)("p",null,"The LICENSE and NOTICE files for the binary distribution are found at:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"},"bookkeeper/bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt (for -all package)")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/NOTICE-all.bin.txt"},"bookkeeper/bookkeeper-dist/src/main/resources/NOTICE-all.bin.txt (for -all package)")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"},"bookkeeper/bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt (for -server package)")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/NOTICE-server.bin.txt"},"bookkeeper/bookkeeper-dist/src/main/resources/NOTICE-server.bin.txt (for -server package)"))),(0,i.yg)("p",null,"When updating these files, use the following rules of thumb:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"BSD/MIT-style dependencies should be covered in LICENSE."),(0,i.yg)("li",{parentName:"ul"},"Apache Software License dependences should be covered in NOTICE, but only if they themselves contain a NOTICE file."),(0,i.yg)("li",{parentName:"ul"},"NOTICE should be kept to a minimum, and only contain what is legally required."),(0,i.yg)("li",{parentName:"ul"},"The LICENSE and NOTICE files for the binary packages should contains everything in source LICENSE and NOTICE packages, unless the source code being referred to does not ship in the binary packages (for example, if it was copied in only for tests)."),(0,i.yg)("li",{parentName:"ul"},"All shipped dependencies should be mentioned in LICENSE for completeness, along with a link to their source code if available."),(0,i.yg)("li",{parentName:"ul"},"Any license other than BSD/MIT-style or ASL should be discussed on ",(0,i.yg)("a",{parentName:"li",href:"/community/mailing-lists"},"the dev list"),"."),(0,i.yg)("li",{parentName:"ul"},"If you have any doubts, raise them on ",(0,i.yg)("a",{parentName:"li",href:"/community/mailing-lists"},"the dev list"),".")),(0,i.yg)("h1",{id:"handling-newupdated-source-dependencies"},"Handling new/updated source dependencies"),(0,i.yg)("p",null,"For bookkeeper, a source dependency is any code which has been copied in code form into our source tree. An example of this is ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/bookkeeper/tree/master/circe-checksum"},"circe-checksum")," which was copied into our codebase and modified. Depending on the license of source code, you may need to update the source distribution LICENSE and NOTICE files."),(0,i.yg)("p",null,"In the case of circe-checksum, the original code is under the Apache Software License, Version 2 (ASLv2), and there is no NOTICE file, so neither LICENSE nor NOTICE need to be updated."),(0,i.yg)("p",null,"If, for example, we were to copy code from ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/hadoop"},"Hadoop"),', and the code in question was originally written for Hadoop, then we would not need to update LICENSE or NOTICE, as Hadoop is also licensed under the ASLv2, and while it has a NOTICE file, the part covering code originally written for Hadoop is covered by the line, "This product includes software developed by The ',(0,i.yg)("a",{parentName:"p",href:"https://www.apache.org/"},"Apache Software Foundation"),'.", which already exists in our NOTICE. However, if we were to copy code from Hadoop that originally originated elsewhere, such as their ',(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/hadoop/blob/f67237cbe7bc48a1b9088e990800b37529f1db2a/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/PureJavaCrc32C.java"},"pure java CRC library"),", this code is originally from Intel, under a BSD style license, so you would have to track down the original license, add it to ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/"},"deps/")," and link it from our LICENSE file."),(0,i.yg)("p",null,"If we were to copy code from ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/netty/netty/"},"Netty"),", and the code in question was originally written for Netty, then we would need to update NOTICE with the relevant portions (i.e. the first section) from the ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/netty/netty/blob/4.1/NOTICE.txt"},"Netty NOTICE file"),", as Netty is licensed under the ASLv2 and it ",(0,i.yg)("em",{parentName:"p"},"does")," contain a NOTICE file. If we were to copy code from Netty which originally originated elsewhere, but had also been modified by Netty, for example ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/netty/netty/blob/b60e0b6a51d59fb9a98918c8783265b30531de57/common/src/main/java/io/netty/logging/CommonsLogger.java"},"their SLF4J modifications"),", we would need to update our NOTICE with the relevant portions (i.e. the first section) from Netty's NOTICE, and also add the SLF4J license to ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/"},"deps/")," and link it from our LICENSE file (as it has an MIT-style license)."),(0,i.yg)("p",null,"If we were to copy code from ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/google/protobuf"},"Protobuf")," or ",(0,i.yg)("a",{parentName:"p",href:"https://www.slf4j.org/"},"SLF4J")," into our code base, then we would have to copy their license to ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/bookkeeper/blob/master/bookkeeper-dist/src/main/resources/"},"deps/")," and link it from our LICENSE file, as these projects are under ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/google/protobuf/blob/master/LICENSE"},"BSD-style")," and ",(0,i.yg)("a",{parentName:"p",href:"https://www.slf4j.org/license.html"},"MIT-style")," licenses respectively."),(0,i.yg)("h1",{id:"handling-newupdated-binary-dependencies"},"Handling new/updated binary dependencies"),(0,i.yg)("p",null,"When a new binary dependency is added, or a dependency version is updated, we need to update the LICENSE and NOTICE files for our binary packages. There is a separate version of each of these files for both the -all tarball and the -server tarball. The files can be found at ",(0,i.yg)("inlineCode",{parentName:"p"},"bookkeeper-dist/src/main/resources"),"."),(0,i.yg)("p",null,"How you update the files depends on the licensing of the dependency. Most dependencies come under either the Apache Software License, Version 2, or an MIT/BSD style license. If the software comes under anything else, it's best to ask for advice on the ",(0,i.yg)("a",{parentName:"p",href:"/community/mailing-lists"},"dev@ list"),"."),(0,i.yg)("h2",{id:"devcheck-binary-license-script"},"dev/check-binary-license script"),(0,i.yg)("p",null,"We provide a script which will check if the LICENSE file attached to a binary tarball matches the jar files distributed in that tarball. The goal of the script is to ensure that all shipped binaries are accounted for, and that nothing else is mentioned in the LICENSE or NOTICE files."),(0,i.yg)("p",null,"To check that licensing is correct, generate the tarball and run the script against it as follows (in this example I've removed references to protobuf from the LICENSE file)."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"~/src/bookkeeper $ mvn clean package -DskipTests\n...\n\n~/src/bookkeeper $ dev/check-binary-license bookkeeper-dist/server/target/bookkeeper-server-4.7.0-SNAPSHOT-bin.tar.gz\ncom.google.protobuf-protobuf-java-3.4.0.jar unaccounted for in LICENSE\ndeps/protobuf-3.4.0/LICENSE bundled, but not linked from LICENSE\n\n~/src/bookkeeper $ \n")),(0,i.yg)("p",null,"The script checks the following:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"If a jar file is included in the tarball, this file must be mentioned in the LICENSE file."),(0,i.yg)("li",{parentName:"ol"},"If a jar file is mentioned in LICENSE or NOTICE, then this jar file must exist in the tarball."),(0,i.yg)("li",{parentName:"ol"},"If a license exists under deps/ in the tarball, this is license must be linked in the LICENSE file."),(0,i.yg)("li",{parentName:"ol"},"If a license is linked from the LICENSE file, it must exist under deps/ in the tarball.")),(0,i.yg)("p",null,"This script will fail the check even if only the version of the dependency has changed. This is intentional. The licensing requirements of a dependency can change between versions, so if a dependency version changes, we should check that the entries for that dependency are correct in our LICENSE and NOTICE files."),(0,i.yg)("h2",{id:"apache-software-license-version-2-binary-dependencies"},"Apache Software License, Version 2 binary dependencies"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},'Add the jar under "The following bundled 3rd party jars are distributed under the Apache Software License, Version 2."'),(0,i.yg)("li",{parentName:"ol"},"Add a link to the source code of this dependency if available. This will help anyone updating the license in the future."),(0,i.yg)("li",{parentName:"ol"},"Check the LICENSE file of the dependency.")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"If it only contains the Apache Software License, Version 2, nothing needs to be copied into our LICENSE file."),(0,i.yg)("li",{parentName:"ul"},"If there is something other than the ASLv2, then you must figure out if it refers to code that is actually shipped in the jar. If it is shipped in the jar, then check the license of that code and apply the rules to it as you would if it was a first order dependency.")),(0,i.yg)("ol",{start:4},(0,i.yg)("li",{parentName:"ol"},"Check the NOTICE file of the dependency, if there is one.")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Copy any copyright notices to our NOTICE, unless they are for Apache Software Foundation (already covered by our own copyright notice), or they are refer to code covered by a BSD/MIT style license (some projects mistakenly put these in the NOTICE file, but these should be noted in the ",(0,i.yg)("em",{parentName:"li"},"LICENSE")," file)."),(0,i.yg)("li",{parentName:"ul"},"Ensure that anything copies from the NOTICE file refers to code which is actually shipped with our tarball. Some projects put optional dependencies in their NOTICE, which are not actually pulled into our distribution, so we should not include these.")),(0,i.yg)("h2",{id:"bsdmit-style-license-binary-dependencies"},"BSD/MIT style license binary dependencies"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},'Add a section to the LICENSE file, stating that "This product bundles X, which is available under X".'),(0,i.yg)("li",{parentName:"ol"},"Add the license to ",(0,i.yg)("inlineCode",{parentName:"li"},"bookkeeper-dist/src/main/resources/deps/")," and add a link to this file from the LICENSE file."),(0,i.yg)("li",{parentName:"ol"},"Ensure that the deps/ license is in the inclusion lists for the correct package assembly specs (",(0,i.yg)("inlineCode",{parentName:"li"},"bookkeeper-dist/src/assemble/"),")."),(0,i.yg)("li",{parentName:"ol"},"The section must state the path of the jar that is covered by the license, so that the tool can pick it up."),(0,i.yg)("li",{parentName:"ol"},"Add a link to the source code of the dependency if available, to make it easier to update the dependency in future."),(0,i.yg)("li",{parentName:"ol"},"Sometimes the LICENSE of a dependency refers to a dependency which they themselves has bundled. These references should be copied to our LICENSE file, as if they were first order dependencies.")),(0,i.yg)("h2",{id:"further-resources"},"Further resources"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"http://www.apache.org/dev/licensing-howto.html"},"Assembling LICENSE and NOTICE")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"http://apache.org/legal/src-headers.html"},"ASF Source Header and Copyright Notice Policy"))))}d.isMDXComponent=!0}}]);